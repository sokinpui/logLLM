# Detailed Documentation for `config.py`

## Overview

The `src/logllm/config/config.py` file contains centralized configuration settings and utility functions for the `logLLM` system. It defines constants and parameters for logging, Docker container management, Elasticsearch, Kibana, data storage indices, LLM models, and agent-specific behaviors. These configurations are imported and utilized by various modules (e.g., CLI commands, agents, utilities) to ensure consistency and facilitate environment-specific adjustments.

---

## Configuration Variables

### Log Configuration

- **`LOGGER_NAME`**

  - **Type**: `str`
  - **Value**: `"MoveLookLogger"`
  - **Purpose**: Defines the name for the primary logger instance used throughout the application.
  - **Usage**: Used by `src.logllm.utils.logger.Logger` to identify the logger.

- **`LOG_FILE`**
  - **Type**: `str`
  - **Value**: `"movelook.log"`
  - **Purpose**: Specifies the default file path where logs generated by the `Logger` instance are written.
  - **Usage**: Configures the `RotatingFileHandler` within the `Logger` class.

---

### Colima Configuration (macOS Docker Environment - Less emphasized if Docker Desktop is primary)

- **`COLIMA_MEMORY_SIZE`**
  - **Type**: `int`
  - **Value**: `4`
  - **Purpose**: Sets the default memory allocation (in Gigabytes) for Colima if it's used and needs to be started.
  - **Usage**: Used by `DockerManager` on macOS if Colima is the chosen Docker environment.

---

### Docker Configuration (General)

- **`DOCKER_NETWORK_NAME`**: `"movelook_network"` (Network for inter-container communication)
- **`DOCKER_VOLUME_NAME`**: `"movelook_volume"` (Volume for persisting Elasticsearch data)
- **`DOCKER_VOLUME_BIND_PATH`**: `"/usr/share/elasticsearch/data"` (Path inside ES container for volume mount)
- **`DOCKER_VOLUME_MODE`**: `"rw"` (Read-write access for the volume)
- **`DOCKER_VOLUME_SETUP`**: Dictionary consolidating volume configuration for `docker-py`.
- **`DOCKER_DETACH`**: `True` (Run containers in detached mode)
- **`DOCKER_REMOVE`**: `False` (Do not automatically remove containers on stop by default)
- **`DOCKER_PORTS_PROTOCOL`**: `"tcp"` (Default protocol for port mappings)

---

### Elasticsearch Configuration

- **`ELASTIC_SEARCH_IMAGE`**: `"docker.elastic.co/elasticsearch/elasticsearch:8.17.1"`
- **`ELASTIC_SEARCH_CONTAINER_NAME`**: `"movelook_elastic_search"`
- **`ELASTIC_SEARCH_PORTS`**: `{"9200/tcp": 9200}` (Maps container port 9200 to host port 9200)
- **`ELASTIC_SEARCH_ENVIRONMENT`**:
  ```python
  {
      "discovery.type": "single-node",
      "xpack.security.enabled": "false", # Note: For production, enable security.
      "xpack.license.self_generated.type": "trial",
  }
  ```
- **`ELASTIC_SEARCH_URL`**: `"http://localhost:9200"` (Connection URL for `ElasticsearchDatabase`)

---

### Kibana Configuration

- **`KIBANA_IMAGE`**: `"docker.elastic.co/kibana/kibana:8.17.1"`
- **`KIBANA_CONTAINER_NAME`**: `"movelook_kibana"`
- **`KIBANA_PORTS`**: `{"5601/tcp": 5601}` (Maps container port 5601 to host port 5601)
- **`KIBANA_ENVIRONMENT`**: `{"ELASTICSEARCH_HOSTS": f"http://{cfg.ELASTIC_SEARCH_CONTAINER_NAME}:9200"}` (Connects Kibana to Elasticsearch via Docker network)

---

### Data Storage Configuration (Elasticsearch Indices)

- **`INDEX_LAST_LINE_STATUS`**: `"log_last_line_status"` (Tracks last line read by `Collector`)
- **`INDEX_LOG_FILES_STORAGE`**: `"log_files"` (Legacy/general purpose, usually superseded by group-specific raw log indices)
- **`INDEX_EVENTS_STORAGE`**: `"events"` (For storing conceptual events, if used)
- **`INDEX_VECTOR_STORE`**: `"vector_store"` (Base prefix for RAG vector store indices)
- **`INDEX_GROUP_INFOS`**: `"group_infos"` (Stores metadata about log groups and their files, used by `Collector` and parsing agents)
- **`INDEX_GROK_RESULTS_HISTORY`**: `"grok_results_history"` (Stores history of `es-parse run` attempts. Replaced by `INDEX_STATIC_GROK_PARSE_STATUS` for the new `static-grok-parse` agent)
- **`INDEX_STATIC_GROK_PARSE_STATUS`**: `"static_grok_parse_status"` (NEW: Stores parsing status per file for `StaticGrokParserAgent`)
- **`INDEX_ERROR_SUMMARIES`**: `"log_error_summaries"` (NEW: Stores LLM-generated error summaries from `ErrorSummarizerAgent`)

---

### LLM Model Configuration

- **`GEMINI_LLM_MODEL`**: `"gemini-1.5-flash-latest"` (Default Gemini model for generation tasks. Value was `gemini-2.0-flash-lite`).

---

### Agents Configuration

- **`RANDOM_SAMPLE_SIZE`**: `16` (Default sample size for some LLM context generation tasks)
- **`MEMRORY_TOKENS_LIMIT`**: `20000` (Token limit for LLM memory context in some agents)

- **Error Summarizer Agent Defaults (NEW)**:
  - **`DEFAULT_ERROR_LEVELS`**: `["error", "critical", "fatal", "warn"]` (Log levels considered errors, now lowercase)
  - **`DEFAULT_MAX_LOGS_FOR_SUMMARY`**: `5000` (Max logs to fetch for an error summary run)
  - **`DEFAULT_EMBEDDING_MODEL_FOR_SUMMARY`**: `"sentence-transformers/all-MiniLM-L6-v2"` (Default embedding model for error clustering. Can be local or API-based like "models/text-embedding-004")
  - **`DEFAULT_LLM_MODEL_FOR_SUMMARY_GENERATION`**: `cfg.GEMINI_LLM_MODEL` (LLM for generating summaries)
  - **`DEFAULT_DBSCAN_EPS_FOR_SUMMARY`**: `0.3` (DBSCAN epsilon for error clustering)
  - **`DEFAULT_DBSCAN_MIN_SAMPLES_FOR_SUMMARY`**: `2` (DBSCAN min_samples for error clustering)
  - **`DEFAULT_MAX_SAMPLES_PER_CLUSTER_FOR_SUMMARY`**: `5` (Max samples from a cluster for LLM input)
  - **`DEFAULT_MAX_SAMPLES_UNCLUSTERED_FOR_SUMMARY`**: `10` (Max samples from unclustered logs for LLM input)

---

## Utility Functions for Index Naming

### Function: `get_log_storage_index(group: str) -> str`

- **Purpose**: Generates a standardized Elasticsearch index name for storing **raw** log entries for a specific group.
- **Parameters**: `group` (str): The name of the log group (e.g., "apache").
- **Returns**: `str`: An index name like `"log_apache"`. Cleans the group name.
- **Usage**: By `Collector` to store raw logs, and by parsing agents as a source.

### Function: `get_pre_process_index(event_id: int) -> str`

- **Purpose**: Generates an index name for intermediate filtered log data related to an event (less emphasized in current structure).
- **Parameters**: `event_id` (int).
- **Returns**: `str`: An index name like `"pre_process_1"`.

### Function: `get_parsed_log_storage_index(group: str) -> str`

- **Purpose**: Generates a standardized Elasticsearch index name for storing **successfully parsed/structured** log data for a specific group.
- **Parameters**: `group` (str): The name of the original log group.
- **Returns**: `str`: An index name like `"parsed_log_apache"`.
- **Usage**: By `StaticGrokParserAgent` as the target for parsed logs. Also the source for `TimestampNormalizerAgent` and `ErrorSummarizerAgent`.

### Function: `get_unparsed_log_storage_index(group: str) -> str`

- **Purpose**: Generates an Elasticsearch index name for storing log entries that **failed parsing** for a specific group by `StaticGrokParserAgent`.
- **Parameters**: `group` (str): The name of the original log group.
- **Returns**: `str`: An index name like `"unparsed_log_apache"`.
- **Usage**: By `StaticGrokParserAgent` as the target for unparsed logs.

### Function: `get_normalized_parsed_log_storage_index(group: str) -> str`

- **Purpose**: DEPRECATED / REPLACED. Previously generated an index name for logs after timestamp normalization. The `TimestampNormalizerAgent` now modifies `parsed_log_<group_name>` indices **in-place**.
- **Parameters**: `group` (str).
- **Returns**: `str`: An index name like `"normalized_parsed_log_apache"`.
- **Note**: This function is still in `config.py` but its output index is not the primary target of the current `TimestampNormalizerAgent`. The `TimestampNormalizerAgent` now updates the `@timestamp` field directly in the `parsed_log_<group_name>` index.
